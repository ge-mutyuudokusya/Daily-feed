<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã˜ã‚ƒã‚“ã‘ã‚“RPG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0ff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    #game {
      display: none;
    }
    .characters {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-top: 20px;
    }
    .character {
      width: 150px;
      transition: transform 0.2s;
    }
    .shake {
      animation: shake 0.4s;
    }
    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(-10px, 0); }
      50% { transform: translate(10px, 0); }
      75% { transform: translate(-5px, 0); }
    }
    .buttons {
      margin-top: 20px;
    }
    .status {
      margin-top: 10px;
    }
    .log {
      margin-top: 10px;
      font-weight: bold;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã˜ã‚ƒã‚“ã‘ã‚“RPG</h1>

<div id="lobby">
  <p>ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
  <input type="text" id="roomInput" placeholder="ä¾‹: abc123" />
  <button onclick="joinRoom()">éƒ¨å±‹ã«å…¥ã‚‹</button>
</div>

<div id="game">
  <h2 id="playerLabel"></h2>

  <div class="characters">
    <img id="character1" class="character" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg5mUgrPY21sib6L8Hj1A7l3xTy7uBIrCwtQBFWoZB2TT2xDcTeC8nfJG6hoirMy_4zN0Hdb-DTFQFR_U4pJDFB_iXPFfnO86eNsDlfcGnKyTp7a_HE3v3FWvFmSiD6L_amVsFd4-W8J2aBJK0h5Ym8_PFu5_7XMNMRl1pyK8BsmjHdgpKpEYXVj7nHk3ax/s938/asobu_cat_shadow.png" />
    <img id="character2" class="character" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiMeLAEhl-RN1MhKnqRh_Z-4faXFsoRU5TB5ykDAiVyKTgI41_bn7GUgYGCT8BUFruiH3UwbUvAaY6eYIopO-kdCEMQJkc3Ls34hpUos9UGlnC4-cSOCAIqHiK79_qi2nCSd9GuoWziiUiU/s1263/job_kantokukan_man.png" />
  </div>

  <div class="buttons">
    <button onclick="sendMove('ã‚°ãƒ¼')">âœŠ ã‚°ãƒ¼</button>
    <button onclick="sendMove('ãƒãƒ§ã‚­')">âœŒ ãƒãƒ§ã‚­</button>
    <button onclick="sendMove('ãƒ‘ãƒ¼')">ğŸ– ãƒ‘ãƒ¼</button>
  </div>

  <div class="stats">
    <div id="stats1"></div>
    <div id="stats2"></div>
  </div>

  <div class="status" id="status">ã˜ã‚ƒã‚“ã‘ã‚“ã‚’å‡ºã—ã¦ãã ã•ã„ï¼</div>
  <div class="log" id="log"></div>
</div>

<script>
  const ws = new WebSocket("ws://localhost:3000");

  let playerNumber = null;
  let roomID = "";
  let myMove = null;
  let opponentMove = null;

  const playerStats = {
    1: { hp: 10, power: 0, will: 0, atk: 3 },
    2: { hp: 10, power: 0, will: 0, atk: 3 }
  };

  function updateStats() {
    document.getElementById("stats1").textContent = `P1 - ä½“åŠ›: ${playerStats[1].hp} æ±ºå®šåŠ›: ${playerStats[1].power} æ„å¿—åŠ›: ${playerStats[1].will}`;
    document.getElementById("stats2").textContent = `P2 - ä½“åŠ›: ${playerStats[2].hp} æ±ºå®šåŠ›: ${playerStats[2].power} æ„å¿—åŠ›: ${playerStats[2].will}`;
  }

  function joinRoom() {
    roomID = document.getElementById("roomInput").value;
    ws.send(JSON.stringify({ type: "join", room: roomID }));
    document.getElementById("lobby").style.display = "none";
    document.getElementById("status").textContent = "å¾…æ©Ÿä¸­...";
  }

  ws.onmessage = function (event) {
    const data = JSON.parse(event.data);

    if (data.type === "start") {
      playerNumber = data.player;
      document.getElementById("playerLabel").textContent = `ã‚ãªãŸã¯ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${playerNumber}`;
      document.getElementById("game").style.display = "block";
      document.getElementById("status").textContent = "ã˜ã‚ƒã‚“ã‘ã‚“ã‚’å‡ºã—ã¦ãã ã•ã„ï¼";
      updateStats();
    }

    if (data.type === "opponentMove") {
      opponentMove = data.hand;
      if (myMove) {
        judge();
      }
    }
  };

  function sendMove(hand) {
    if (!playerNumber) return;
    myMove = hand;
    ws.send(JSON.stringify({ type: "move", room: roomID, hand }));
    document.getElementById("status").textContent = "ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...";
  }

  function judge() {
    const p = playerNumber;
    const op = p === 1 ? 2 : 1;

    let result = "";
    if (myMove === opponentMove) {
      result = "ã‚ã„ã“ï¼";
      playerStats[p].power += 1;
      playerStats[op].power += 1;
    } else {
      const win =
        (myMove === "ã‚°ãƒ¼" && opponentMove === "ãƒãƒ§ã‚­") ||
        (myMove === "ãƒãƒ§ã‚­" && opponentMove === "ãƒ‘ãƒ¼") ||
        (myMove === "ãƒ‘ãƒ¼" && opponentMove === "ã‚°ãƒ¼");

      if (win) {
        result = "å‹ã¡ï¼";
        playerStats[p].will += 1;
        playerStats[op].power += 1;
        playerStats[op].hp -= 2;
        document.getElementById("character" + op).classList.add("shake");
      } else {
        result = "è² ã‘...";
        playerStats[p].hp -= 2;
        playerStats[p].power += 1;
        document.getElementById("character" + p).classList.add("shake");
        playerStats[op].will += 1;
      }
    }

    if (playerStats[p].hp <= 0) {
      result += " ã‚ãªãŸã®æ•—åŒ—ã§ã™ã€‚";
    } else if (playerStats[op].hp <= 0) {
      result += " ç›¸æ‰‹ã®æ•—åŒ—ã§ã™ã€‚";
    }

    document.getElementById("log").textContent = `ã‚ãªãŸ: ${myMove} / ç›¸æ‰‹: ${opponentMove} â†’ ${result}`;
    myMove = null;
    opponentMove = null;
    updateStats();

    setTimeout(() => {
      document.getElementById("character1").classList.remove("shake");
      document.getElementById("character2").classList.remove("shake");
    }, 500);
  }
</script>

</body>
</html>
